%script
  :plain
    $(function() {
  ="var target = #{Encounter.exp.map { |e|  e * 5} }"
  :plain
    create_encounter_creation(target);
    });


= form_for @encounter, :html => {:class => "form-horizontal" } do |f|
  - if @encounter.errors.any?
    #error_explanation
      %div{:class => "alert alert-error"}
        %h2= "#{pluralize(@encounter.errors.count, "error")} prohibited this encounter from being saved:"
        %ul
          - @encounter.errors.full_messages.each do |msg|
            %li= msg

  %div.row-fluid
    %fieldset
      %div.span6
        %div.control-group
          = f.label :name, :class => "control-label"
          %div.controls
            = f.text_field :name, :class => "input-xlarge"
        %div{:class => "control-group row-fluid"}
          = f.label :experience, :class => "control-label"
          %div{:class => "span2"}
            = f.number_field :experience, :class => "input-small"
          %div{:class => "offset6 "}
            = f.number_field :experience, :class => "input-small", :id => "computed-exp"
            Target:
            %span{:id => "target-lev"} 
        %label.radio
          = f.check_box :completed
          = "Completed"
        - monsters = Monster.find(:all, :order => "level DESC")
        - monsters.each do |monster|
          %div{:class => "controls-row"}
            %label{:class => "span8"}
              = "#{monster.name} (#{monster.tier.capitalize} #{monster.level})"
              = check_box_tag "incmonster[#{monster.id}]", true, @encounter.monsters.include?(monster), :class => "monster-check"
              = hidden_field_tag "expmonster[#{monster.id}]", monster.experience
            - count = @encounter.monsters.count(:conditions => "monster_id = #{monster.id}")
            - count = 1 if count == 0
            = number_field_tag "nummonster[#{monster.id}]", count, :class => "input-mini span2 nummonster"
      %div.span5
        - monsters.each do |monster|
          = image_tag(monster.image, :class => "img-rounded", :id => "img_#{monster.id}")

  %div.form-actions
    = f.submit 'Save', :class => "btn btn-primary"


